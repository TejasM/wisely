{% extends 'base-app.html' %}
{% load staticfiles %}
{% block additionalHeaders %}
    <link href='http://fonts.googleapis.com/css?family=Satisfy' rel='stylesheet' type='text/css'>
    <link href="{% static 'css/auth-buttons.css' %}" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{% static 'css/style-app.css' %}"/>
    <script src="https://checkout.stripe.com/checkout.js"></script>
{% endblock %}
{% block content %}
    <div class="jumbotron margin-none center">
        <div class="row">
            <div class="col-sm-10 col-sm-offset-1">
                <h1 class="separator bottom">Your Pledges</h1>
            </div>
            <div class="col-sm-1">
                <a href="{% url 'pledges:create' %}">
                    <button class="btn btn-primary btn-lg text-right">Create</button>
                </a>
            </div>
        </div>

        <div class="row extra-top-margin col-separator" style="position: static;">
            {% for pledge in all_pledges_list %}
                {% if forloop.first %}
                    <div class="col-separator-h"></div>
                {% endif %}
                <div class="media margin-none">
                    <div class="media-body innerAll">
                        <h4 class="media-heading innerT"><a href=""
                                                            class="text-inverse">{{ pledge.course }}</a> <span
                                class="text-small"><i
                                class="fa fa-fw fa-clock-o"></i>&nbsp; {{ pledge.created }}</span>
                        </h4>

                        <div class="row extra-top-margin">
                            <div class="col-sm-6">
                                Pledge of &nbsp;<h3 style="display: inline" class="cursive">
                                $ {{ pledge.money|floatformat:2 }}</h3> &nbsp;to get {{ pledge.get_aim|floatformat:0 }}%
                            </div>
                            <div class="col-sm-6">
                                <a href="{% url 'pledges:share' pledge.id %}">
                                    <button class="btn btn-primary btn-lg text-right">Share</button>
                                </a>
                                <span style="float: right">
                                <i class="fa fa-eye"></i> {{ pledge.follower_set.count }} followers</span>

                            </div>
                        </div>
                    </div>
                    {% for projections in all_projections %}
                        {% if forloop.counter == forloop.parentloop.counter %}
                            <div class="widget" style="margin-bottom: 0" data-toggle="collapse-widget"
                                 data-collapse-closed="true">
                                <div class="widget-head"><h4 class="heading">Projected Rewards</h4><span
                                        class="collapse-toggle"></span></div>
                                <div class="widget-body collapse" style="height: 20px;">
                                    <div class="innerLR row extra-top-margin">
                                        <div class="centered">
                                            <div class="row centered">
                                                <div class="col-sm-12">
                                                    <p class="super" style="display: inline-block; margin-left: 160px;">
                                                        Pledge Goal
                                                    </p>

                                                    <p class="super" style="display: inline-block; margin-left: 25px;">
                                                        Followers
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-sm-12" style="margin-top: -7px">
                                                    <div class="full-reward centered circles">
                                                        <p>${{ projections.2|floatformat }}</p>
                                                    </div>
                                                    <div class="pure-reward centered circles">
                                                        <p>{{ pledge.get_aim }}%</p>
                                                    </div>
                                                    <div class="follower-reward centered circles">
                                                        <i class="fa fa-eye"></i>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row centered">
                                                <div class="col-sm-12" style="margin-top: -10px">
                                                    <p class="sub" style="display: inline-block; margin-left: 160px;">
                                                        ${{ projections.1|floatformat }}
                                                    </p>

                                                    <p class="sub" style="display: inline-block; margin-left: 35px;">
                                                        ${{ projections.0|floatformat }}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% if not pledge.is_active %}
                                        <div class="innerLR row extra-top-margin">
                                            <div class="col-sm-12">
                                                Note: Rewarded only if pledge is made real.
                                                <button class="btn btn-primary btn-lg" id="real-make-{{ pledge.id }}"
                                                        type="submit">Make
                                                    It Real
                                                </button>
                                                <script>
                                                    var string = "#real-make-{{ pledge.id }}";
                                                    var string2 = "#pay-form";
                                                    $(string).click(function () {
                                                        $('#pay-pledge-id').val('{{ pledge.id }}');
                                                        var token = function (res) {
                                                            var $input = $('<input type=hidden name=stripeToken />').val(res.id);
                                                            $(string2).append($input).submit();
                                                        };
                                                        var money = parseInt("{{ pledge.money }}") * 100;
                                                        if (!isNaN(money)) {
                                                            StripeCheckout.open({
                                                                key: 'pk_test_GUMeKfQZ4BkZzS5GyaZzG7Qb',
                                                                address: false,
                                                                amount: money,
                                                                currency: 'cad',
                                                                name: "Pledge",
                                                                description: "For " + "{{ pledge.course }}",
                                                                panelLabel: 'Pledge ',
                                                                token: token
                                                            });
                                                        }
                                                        return false;
                                                    });
                                                </script>
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
                <form method="post" action="" id="pay-form">
                    {% csrf_token %}
                    <input type="hidden" value="" name="pledge-id" id="pay-pledge-id">
                </form>
                <div class="col-separator-h"></div>
            {% endfor %}
        </div>
    </div>
{% endblock %}
{% block additionalScripts %}
    <script src="{% static 'js/jquery.number.js' %}"></script>
    <script src="{% static 'assets/components/modules/admin/widgets/widget-collapsible/assets/widget-collapsible.init.js' %}?v=v1.9.6&sv=v0.0.1"></script>
    <script>
        $(function () {
            $('input.dollar').number(true, 2)
        });
    </script>
{% endblock %}
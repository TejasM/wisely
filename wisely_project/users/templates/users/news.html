{% extends 'base-app-alt.html' %}
{% load staticfiles %}
{% block headers_css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/style-news.css' %}" cache="false"/>
{% endblock %}
{% load humanize %}
{% block content %}
    <div class="row wide-row" style="border-bottom: solid #D2D4D5 1px">
        <div class="large-4 columns" style="border-right: solid #D2D4D5 1px; padding-top: 1%; padding-bottom: 1%;">
            <div class="row">
                <div class="large-3 columns">
                    <img {% if user_profile.picture %}src="/media/{{ user_profile.picture }}"
                         {% else %}src="http://www.adas-lv.com/wp-content/uploads/2012/07/default_avatar.png"{% endif %}
                         class="pull-left img-circle">
                </div>
                <div class="large-6 columns">
                    <div style="margin-top: 10px">
                        <h3>{{ user_profile.user.first_name }} {{ user_profile.user.last_name }}</h3>

                        {% if user_profile.headline %}
                            <p>{{ user_profile.headline }}</p>
                        {% endif %}
                    </div>
                </div>
                <div class="large-3 columns">
                    <img src="{% static 'images/settings-icon.png' %}" style="width: 80%; margin-top: 10px">
                </div>
            </div>
        </div>
        <div class="large-8 columns" style="margin-top: 50px; text-align: center">
            <div class="row" id="filters">
                <div class="large-4 columns"><p class="selected-news" id="everyone-filt">Everyone</p></div>
                <div class="large-4 columns"><p id="following-filt">Following</p></div>
                <div class="large-4 columns"><p id="followers-filt">Followers</p></div>
            </div>
        </div>
    </div>
    <div class="row wide-row">
        <div class="large-4 columns">
            <div class="row">
                <dl class="tabs vertical" style="width: 100%" data-tab>
                    <dd class="active"><a href="#panel1a" onclick="$('#filters').show();"><i class="fa fa-desktop"></i>Newsfeed</a>
                    </dd>
                    <dd><a href="#panel2a" onclick="$('#filters').hide();"><i class="fa fa-bell"></i> Notifications</a>
                    </dd>
                    <dd><a href="#panel3a" onclick="$('#filters').hide();"><i class="fa fa-users"></i>Friends</a></dd>
                    <dd><a href="#panel4a" onclick="$('#filters').hide();"><i class="fa fa-envelope"></i>Inbox</a></dd>
                </dl>
            </div>
            {% if who_to_follow %}
                {% include 'users/who_to_follow.html' with who_to_follow=who_to_follow %}
            {% endif %}
        </div>

        <div class="large-8 columns" style="padding-top: 1%;">
            <div class="row">
                <div class="large-12 columns">
                    <div class="tabs-content vertical" style="width: 100%">
                        <div class="content active" id="panel1a">
                            {% if feeds %}
                                <ul class='timeline feed'>
                                    {% for feed in feeds %}
                                        {% if feed.actor_content_type.name == "user" and feed.actor.first_name %}
                                            <li class='work {% if feed.actor.userprofile in followers %}followers{% endif %} {% if feed.actor.userprofile in user_profile.follows %}following{% endif %}'>
                                                <input class='radio' type='radio' checked>

                                                <div class="relative">
                                        <span class='circle img-circle'><img
                                                src="{% if feed.actor.userprofile.picture %}/media/{{ feed.actor.userprofile.picture }}
                                                     {% else %}http://www.adas-lv.com/wp-content/uploads/2012/07/default_avatar.png{% endif %}"
                                                width="40"
                                                style="margin-left: 2px"></span>
                                                </div>
                                                <div class='content-news'>
                                                    <p>
                                                        <a href="/users/profile/{{ feed.actor_object_id }}">
                                                            {{ feed.actor.first_name }} {{ feed.actor.last_name }}
                                                        </a>
                                                        {% if feed.actions_with_pledges_pledge_as_action_object == None %}
                                                            <a href="/pledges/share/{{ feed.action_object_object_id }}">
                                                        {% endif %}
                                                        {{ feed.verb }}
                                                        {% if feed.actions_with_pledges_pledge_as_action_object == None %}
                                                            </a>
                                                        {% endif %}
                                                        {% if feed.target %}
                                                            {% if feed.actions_with_users_course_as_target == None %}
                                                                <a href="{{ feed.target.course_link }}">{{ feed.target }}</a>
                                                            {% else %}
                                                                {{ feed.target }}
                                                            {% endif %}
                                                        {% endif %}
                                                    </p>

                                                    <p>{{ feed.timestamp|naturaltime }}</p>
                                                </div>
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>
                        <div class="content" id="panel2a">
                            {% if notification_list %}
                                <ul class='timeline'>
                                    {% for notification in notification_list %}
                                        {% if notification.actor_content_type.name == "user" and notification.actor.first_name %}
                                            <li class='work'>
                                                <input class='radio' type='radio' checked>

                                                <div class="relative">
                                        <span class='circle img-circle'><img
                                                src="{% if notification.actor.user_profile.picture %}/media/{{ notification.actor.user_profile.picture }}
                                                     {% else %}http://www.adas-lv.com/wp-content/uploads/2012/07/default_avatar.png{% endif %}"
                                                width="40"
                                                style="margin-left: 2px"></span>
                                                </div>
                                                <div class='content-news'>
                                                    <p>
                                                        <a href="/users/profile/{{ notification.actor_object_id }}">
                                                            {{ notification.actor.first_name }} {{ notification.actor.last_name }}
                                                        </a>
                                                        {% if notification.actions_with_pledges_pledge_as_action_object == None %}
                                                            <a href="/pledges/share/{{ notification.action_object_object_id }}">
                                                        {% endif %}
                                                        {{ notification.verb }}
                                                        {% if notification.actions_with_pledges_pledge_as_action_object == None %}
                                                            </a>
                                                        {% endif %}
                                                        {% if notification.target %}
                                                            {% if notification.actions_with_users_course_as_target == None %}
                                                                <a href="{{ notification.target.course_link }}">{{ notification.target }}</a>
                                                            {% else %}
                                                                {{ notification.target }}
                                                            {% endif %}
                                                        {% endif %}
                                                    </p>

                                                    <p>{{ notification.timestamp|naturaltime }}</p>
                                                </div>
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                </ul>
                            {% else %}
                                You have no notifications.
                            {% endif %}
                        </div>
                        <div class="content" id="panel3a">
                            {% if user_profile.follows %}
                                <ul class="follower-list">
                                    {% for following in user_profile.follows.all %}
                                        <li>
                                            <div class="row" style="margin: 3% 5%;">
                                                <div class="large-3 columns" style="padding: 0 4%;">
                                                    <img {% if following.picture %}src="/media/{{ following.picture }}"
                                                         {% else %}src="http://www.adas-lv.com/wp-content/uploads/2012/07/default_avatar.png"{% endif %}
                                                         class="pull-left img-circle">
                                                </div>
                                                <div class="large-9 columns">
                                                    <div>
                                                        <h3 style="font-size: 16px">{{ following.user.first_name }} {{ following.user.last_name }}</h3>
                                                        {% if following.headline %}
                                                            <p>{{ following.headline }}</p>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                You are not following anyone yet!
                            {% endif %}
                        </div>
                        <div class="content" id="panel4a" style="width: 100%">
                            {% include 'django_messages/inbox.html' %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="other-messages" class="light-box">
        <i class="fa fa-times-circle-o close" style="margin-top: -25px; margin-right: -30px; float: right"></i>

        <div class="row text-center" id="other-message">
        </div>
    </div>
    {% include 'django_messages/reply.html' with path=request.get_full_path %}
{% endblock %}
{% block additionalScripts %}
    <script src="{% static 'js/foundation/foundation.tab.js' %}"></script>
    <script src="{% static 'js/foundation/foundation.accordion.js' %}"></script>
    <script>
        $(function () {
            $('#everyone-filt').click(function () {
                $('.feed').find('li').show();
                $('#filters').find('p').removeClass('selected-news');
                $(this).addClass('selected-news');
            });
            $('#followers-filt').click(function () {
                var $feed = $('.feed');
                $feed.find('li.followers').show();
                $feed.find('li:not(.followers)').hide();
                $('#filters').find('p').removeClass('selected-news');
                $(this).addClass('selected-news');
            });
            $('#following-filt').click(function () {
                var $feed = $('.feed');
                $feed.find('li.following').show();
                $feed.find('li:not(.following)').hide();
                $('#filters').find('p').removeClass('selected-news');
                $(this).addClass('selected-news');
            });
        });
        function follow_add(id) {
            $.post('{% url 'users:follow' %}', {user_id: id }).done(function (data) {
                if (data['HTTPRESPONSE'] == "1") {
                    $('#other-message').text('Now following {{ viewed_user.first_name }} {{ viewed_user.last_name }}');
                    $('#other-messages').show();
                    $('#follow_' + id.toString()).hide();
                } else {
                    $('#other-message').text('Something went wrong try again later');
                    $('#other-messages').show();
                }
            });
        }
    </script>
{% endblock %}